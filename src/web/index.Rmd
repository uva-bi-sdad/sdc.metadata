---
title: "Social Data Commons Data Library"
output: 
  html_document
---

```{r setup, echo = FALSE, include = FALSE, eval = TRUE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE, eval = FALSE)
library(jsonlite)

url <- "https://raw.githubusercontent.com/uva-bi-sdad/sdc.metadata/master/data/measure_info_all.json"

library(DT)
library(purrr)
library(tidyverse)
library(data.table)
library(foreach)
```

```{r, eval = TRUE}
rbindlist.v2 <- function(l)
{
  l <- l[lapply(l, class) == "list"]
  df <- foreach(element = l, .combine = bind_rows, .errorhandling = 'remove') %do%
    {df = unlist(element); df = as.data.frame(t(df)); rm(element); return(df)}
  rm(l)
  return(df)
}
```

## Search all measures

```{r, eval = TRUE, echo = FALSE, include = TRUE, message = FALSE, warning = FALSE}
list <- rbindlist.v2(fromJSON(url)) %>% as.data.frame() %>% select(category, long_name, short_description, short_name, statement, type)

table <- datatable(list)
```

```{r, eval = TRUE, include = TRUE}
# a custom table container
container <- htmltools::withTags(table(
  class = 'display',
  thead(
    tr(
      th(rowspan = 3, 'category'),
      th(rowspan = 3, 'equity_category'),
      th(rowspan = 3, 'short_name'),
      th(colspan = 3, 'long_name'),
      th(colspan = 3, 'short_description'),
      th(colspan = 3, 'short_name'),
      th(colspan = 3, 'type'),
      th(colspan = 3, 'statement')
    ))))
  #,
#    tr(
#      th(colspan = 7, 'sources.date_accessed', bgcolor = "#E8E8E8"),
#      th(colspan = 3, 'sources.name'),
#      th(colspan = 3, 'DC', bgcolor = "#E8E8E8")
#    ),
#    tr(
#      th(colspan = 1, 'county', bgcolor = "#E8E8E8"), 
#      th(colspan = 1, 'tract', bgcolor = "#E8E8E8"),
#      th(colspan = 1, 'block group', bgcolor = "#E8E8E8"),
#      th(colspan = 1, 'supervisor district', bgcolor = "#E8E8E8"), 
#      th(colspan = 1, 'planning district', bgcolor = "#E8E8E8"),
#      th(colspan = 1, 'zipcode', bgcolor = "#E8E8E8"), 
#      th(colspan = 1, 'civic association', bgcolor = "#E8E8E8"),
#      th(colspan = 1, 'county'), 
#      th(colspan = 1, 'tract'),
#      th(colspan = 1, 'block group'),
#      th(colspan = 1, 'county', bgcolor = "#E8E8E8"), 
#      th(colspan = 1, 'tract', bgcolor = "#E8E8E8"),
#      th(colspan = 1, 'block group', bgcolor = "#E8E8E8")
#      )
#    )))

# to run
#datatable(list, container = container)
datatable(list)
```

## Dataset column descriptions
```{r, eval = TRUE, echo = FALSE, include = TRUE, message = FALSE, warning = FALSE}
datatable(data.table(as.character(read_json("https://raw.githubusercontent.com/uva-bi-sdad/data_repo_structure/main/column_structure.json"))) %>% cbind(
  c("An abbreviated name of the measure", 
    "Type of measure, being taken out",
    "Standard name for the geography",
    "Geographic resolution of the measure",
    "The actual value for that measure, geoid, year combination",
    "The year for the measure",
    "Margin of error for the measure, if available")))
```


## Measure info key descriptions
```{r, eval = TRUE, echo = FALSE, include = TRUE, message = FALSE, warning = FALSE}
datatable(data.table(names(read_json("https://raw.githubusercontent.com/uva-bi-sdad/sdc.metadata/master/src/data_repo_structure/measure_info_template.json"))) %>% cbind(
  c("Thematic category for the measure, corresponds to SDC data areas", 
    "Being taken out",
    "Short name for the measure (nchar recommended)",
    "Long name for the measure (nchar recommended)",
    "Short description for the measure (nchar recommended)",
    "Long description for the measure (nchar recommended)",
    "Describes how the measure relates to equity. One of Status, Accessibility, Availability, or Affordability",
    "Source of the data for the measure, if transformed data the primary data source",
    "Any references asssociated with the production of the data, e.g. paper citing the method, reports creating the method")))
  
# type
#units = units associated with the value to interpret the measure
#data_type = automatically generated, either character or numeric
#measure_type = type of the measure, one of (kathryn's list)
```
