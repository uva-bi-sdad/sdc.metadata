---
title: "Social Data Commons Data Dictionary"
output: 
  html_document
---

```{r setup, echo = FALSE, include = FALSE, eval = TRUE}
# Load packages
#knitr::opts_chunk$set(echo = FALSE, include = FALSE, eval = FALSE)
library(jsonlite)
library(DT)
library(purrr)
#library(tidyverse)
library(data.table)
library(foreach)
library(htmltools)
library(dplyr)

# Function to bind a list
rbindlist.v2 <- function(l)
{
  l <- l[lapply(l, class) == "list"]
  df <- foreach(element = l, .combine = bind_rows) %do%
    {df = unlist(element); df = as.data.frame(t(df)); rm(element); return(df)}
  rm(l)
  return(df)
}
```

## Search all measures

```{r search_measures, eval = TRUE, echo = FALSE, include = TRUE, message = FALSE, warning = FALSE}
# Load data from measure_info_all
# To do: figure out adding sources
url <- "https://raw.githubusercontent.com/uva-bi-sdad/sdc.metadata/master/data/measure_info_all.json"
json <- fromJSON(url)

list <- rbindlist.v2(json) %>% as.data.frame() %>% select(category, short_name, long_name, short_description, long_description, statement) %>% mutate(measure = names(json[lapply(json, class) == "list"])) %>% select(measure, category, long_name, long_description)

# sources
#list <- rbindlist.v2(fromJSON(url)) %>% as.data.frame() %>% select(category, short_name, long_name, short_description, long_description, statement) %>% mutate(measure = names(fromJSON(url)))

#container <- htmltools::withTags(table(
#  class = 'display',
#  thead(
#    tr(th(rowspan = 1, 'measure'),
#      th(rowspan = 3, 'category'),
#      th(colspan = 3, 'long_name'),
#      th(colspan = 3, 'long_description')))))

list %>% datatable()

```

## Dataset column descriptions {#columns}
```{r column_descriptions, eval = TRUE, echo = FALSE, include = TRUE, message = FALSE, warning = FALSE}
data.table(as.character(read_json("https://raw.githubusercontent.com/uva-bi-sdad/sdc.metadata/master/src/data_repo_structure/column_structure.json"))) %>% 
  cbind(c("ID for the geography, either taken from census geographies or created by SDAD", 
    "Human and machine readable ID for the measure",
    "Type of the measure, one of [percent, count, index, cost, date time, speed]",
    "Name of the region mapped to geoid, taken from census or stakeholders",
    "Geographic resolution of the measure, one of ['health district', 'county', 'tract', 'block group', 'civic association', 'zipcode', '']",
    "Value of the measure for the given measure, geoid, and year combination",
    "The year of the measure",
    "Margin of error for the measure, if available")) %>% 
  datatable(colnames = c("column name", "description"),
            options = list("pageLength" = 20))
```


## measure_info key descriptions {#measure_info}
```{r measure_info_key_descriptions, eval = TRUE, echo = FALSE, include = TRUE, message = FALSE, warning = FALSE}
data.table(as.character(read_json("https://raw.githubusercontent.com/uva-bi-sdad/sdc.metadata/master/src/data_repo_structure/measure_structure.json"))) %>%
  cbind(c("Thematic category or categories for the measure, one or more of of ['Behavioral Health, Substance Use Disorder and Recovery', 'Business Climate', 'Broadband', 'Demographics', 'Education', 'Employment/Workforce Development', 'Health', 'Housing', 'Health Opportunity Index', 'Nutrition and Food Security', 'Transportation']", 
    "Citations for methods used to produce the measure, <a href = '#citations'> see citations format</a>",
    "Automatically inferred. Type of the data, one of [character, numeric, geography].",
    "Describes how the measure relates to equity, one of ['Status', 'Accessibility', 'Availability', or 'Affordability']",
    "Related shapefile of points with the measure",
    "Long account of the production of the measure (no character limit). Should include detail on methods, multiple data sources, the way things were combined, decisions made to create the measure.",
    "Human readable long name for the measure (55 char limit)",
    "Type of the measure, one of ['percent', 'count', 'index', 'cost', 'date time', 'speed']",
    "Short account of the production of the measure (100 char limit)",
    "Human readable short name for the measure (40 char limit)",
    "Data source from which the measure is derived, <a href = '#sources'> see sources format</a>",
    "Dynamic statement to describe the value of the data for a given geoid and year combination, <a href = '#statement'> see statement format</a>",
    "----",
    "Units associated with the measure")) %>% 
  datatable(colnames = c("measure_info key", "description"), 
            options = list("pageLength" = 20),
            escape=FALSE)
```

## measure_info citations description {#citations}

## measure_info sources description {#sources}

## measure_info statement description {#statement}
